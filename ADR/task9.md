# ADR Настройка чтения с реплик и консистентность

## products
|Операция|Реплика|Задержка|Обоснование|
|:--|:--|:--|:--|
|Просмотр каталога|secondary|Несколько секунд|Каталог - еще не совсем оферта, риск частого изменения описания минимален|
|Просмотр карточки товара|secondary|Секунда|Это *почти* оферта, риск изменения уже чуть выше|
|Аналитика просмотров|secondary|Секунды|Если таковая аналитика будет запрошена заказчиком (интересуемость клиентов товарами). Стоит учитывать, что secondary используется для снижения нагрузки на функционал основной воронки, потенциально, несколько не точен.|
|Описание товара на странице выписки|primary|-|Это оферта, нужна точная информация о цене и наличии. Строгая консистентность.|
|Проверка наличия товара как шаг до оформления заказа|primary|-|Последяя проверка, заказ отсутствующего товара - удар по репутации. Строгая консистентность.|

## orders
|Операция|Реплика|Задержка|Обоснование|
|:--|:--|:--|:--|
|Список заказов клиента|secondary|Минуты|История заказов — данные, для которых в конечном счете будет достигнута согласованность.|
|Мониторинг статусов заказов|secondary|Секунды|Например, для отдела поддержки пользователей. Не критична моментальная оперативность, но и сильная задержка недопустима.|
|Аналитика (например, группировка по категориям товаров за месяц) - как для клиента, так и для внутреннего пользования|secondary|Минуты|Идеальная точность не требуется - гравное тренд, за крайним редким исключением - всплеска на текущий момент.|
|Заказ в процессе оформления, оплаты, изменения|primary|-|Текущий заказ — критически важные данные, требующие строгой консистентности.|

## carts
|Операция|Реплика|Задержка|Обоснование|
|:--|:--|:--|:--|
|Просмотр корзины|secondary|Секунды|Можно использовать secondary, с условием read-only режима и пониманием, что это *почти* актуальные данные - например, на основной странице сайта в углу отрисован виджет корзины, вот он может смотреть на secondary.|
|Аналитика поведения клиентов|secondary|Секунды|Если таковая аналитика будет запрошена заказчиком (работа клиентов с корзиной *до* оформления заказа). Стоит учитывать, что secondary используется для снижения нагрузки на функционал основной воронки, потенциально, несколько не точен (для повышения точности - задержка в секунды). В данном случае аналитика - тренд, поэтому приемлимо.|
|Добавление товаров в корзину|primary|-|Это то, что *может* стать заказом, станет или нет - зависит от четкости работы коллекции. Максимально строгая консистентность.|
|Обновление количества товара в корзине|primary|-|Это то, что *может* стать заказом, станет или нет - зависит от четкости работы коллекции. Максимально строгая консистентность.|
|Оформление заказа из корзины|primary|-|Только те товары, которые выбрал клиент. Никаких расходжений: это будущий заказ - значит деньги и репутация. Максимально строгая консистентность.|